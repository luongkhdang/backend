let's devise a practical and balanced approach to determine clusters.is_hot that incorporates key factors without becoming overly complex to implement initially.

We want to capture significance beyond just size, focusing on recency, influence, and relevance, while keeping it feasible.

Balanced Approach:

Instead of just using article_count, calculate a "hotness score" for each cluster based on a weighted combination of these factors:

Size Factor (Refined):
Why: Larger clusters often represent more dominant themes.
How: Use the article_count but consider applying a logarithmic scale (log(article_count + 1)) so that extremely large clusters don't completely overshadow other factors. Normalize this value (e.g., scale it to be between 0 and 1 based on the range of log-counts across all clusters).
Feasibility: High (count is already available).

Recency Factor:
Why: Hot topics are usually current news.  
How: For each cluster, calculate the proportion of its articles published within a recent timeframe (e.g., last 3 days). This requires fetching pub_date for articles in the cluster. A higher proportion yields a higher score (0 to 1).
Feasibility: Medium (requires an extra query or fetching dates alongside embeddings initially).

Entity Influence Factor:
Why: Clusters involving influential actors/organizations are more likely to be "hot".  
How: For each cluster, calculate the average influence_score of all unique entities linked to the articles within that cluster. This requires querying article_entities and entities tables based on the article IDs in the cluster. Normalize this average score (e.g., based on the observed range of average scores).
Feasibility: Medium (requires joining across tables based on article IDs).

Topic Relevance Factor (Simplified):
Why: Align with the platform's core focus areas.  
How: Use the keywords generated by the basic spaCy interpretation step (which you already plan to run for top clusters). Check if any of the top 3-5 keywords/topics match a predefined list of core relevant terms ( see predefined-list-of-core list). Assign a binary score (e.g., 1 if there's a match, 0 otherwise).
Feasibility: Medium (depends on running the interpretation step and maintaining a keyword list).

predefined-list-of-core list:
China
US / United States
Vietnam
Europe
Germany
War
Trade / Exports / Tariffs
Geopolitics / Geopolitical
Political Economy
Influence / Lobbying
Narrative / Framing
Disinformation / Misinformation
AI / Artificial Intelligence (especially regarding policy/influence)
Election / Campaign
Pentagon / Defense
State Department / Diplomacy
ITC / International Trade Commission

Implementation Steps:

Calculate Factors: After HDBSCAN runs and you have the article*ids for each cluster label:
Retrieve necessary data (pub_date, linked entities.influence_score) for the articles in each cluster.
Run keyword extraction (if using Topic Relevance).
Calculate the normalized score (0-1 range) for each factor (Size, Recency, Influence, Relevance) for every cluster.
Combine Scores: Calculate a final hotness_score using weights defined possibly via environment variables (e.g., W_SIZE=0.2, W_RECENCY=0.3, W_INFLUENCE=0.3, W_RELEVANCE=0.2): hotness_score = (W_SIZE * size*score) + (W_RECENCY * recency*score) + (W_INFLUENCE * influence*score) + (W_RELEVANCE * relevance_score)
Apply Threshold: Define a HOTNESS_THRESHOLD (e.g., 0.6 via environment variable). A cluster is hot if hotness_score >= HOTNESS_THRESHOLD.
Update insert_clusters: Modify the insert_clusters function (or add a function before it) in step2.py to perform these calculations and pass the resulting True/False value for is_hot to the database insertion call, instead of calculating it based only on article_count.

is_hot in the articles Table:
Current Status: The step2.py script, specifically the batch_update_article_cluster_assignments function, only updates the cluster_id in the articles table. It does not currently set the articles.is_hot flag based on the cluster assignment.
Database Schema: The articles table schema in @read does have an is_hot BOOLEAN DEFAULT FALSE column, meaning it's ready to be used.
Best Way to Identify/Set articles.is_hot: The most logical approach, consistent with the platform's structure, is to derive the article's hotness from the cluster it belongs to. If an article is assigned to a cluster marked as is_hot, the article itself should also be marked is_hot.
